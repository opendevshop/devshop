---
##

language: python
python: "2.7"
install:

  # Install DevShop with the standalone installer, using local playbooks.
  # Run as actual root?  Testing to see if this is a problem.
  - sudo ls -la $TRAVIS_BUILD_DIR -R
  - sudo chmod +r $TRAVIS_BUILD_DIR -R
  - sudo ls -la $TRAVIS_BUILD_DIR -R

  # Testing if aegir user can access build-devmaster.make
  - sudo su aegir -c "cat $TRAVIS_BUILD_DIR/build-devmaster.make"
  - sudo su root -c "bash install.sh $TRAVIS_BUILD_DIR"

script:
  # Run `devshop status` command.
  - sudo su aegir -c "devshop status"

  # Test for DevShop
  - ls -la $TRAVIS_BUILD_DIR
  - cd $TRAVIS_BUILD_DIR/tests && sudo composer install && sudo su aegir -c "bin/behat --profile travis"

# Notify devshop IRC chatroom.
notifications:
  irc: "chat.freenode.net#devshop"
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/5c08b3d3486eed16f82c
    on_success: change
    on_failure: always
    on_start: false

sudo: required
dist: trusty
addons:
  hosts:
    - localhost